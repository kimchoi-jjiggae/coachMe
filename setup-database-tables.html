<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Database Tables</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background: #d1fae5; border-color: #10b981; }
        .error { background: #fee2e2; border-color: #ef4444; }
        .info { background: #d1ecf1; border-color: #0c5460; }
        .code { background: #f8f9fa; padding: 10px; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üóÑÔ∏è Setup Database Tables</h1>
    
    <div class="result info">
        <h3>Step 1: Go to Supabase SQL Editor</h3>
        <p>1. Go to your Supabase dashboard</p>
        <p>2. Click on "SQL Editor" in the left sidebar</p>
        <p>3. Click "New Query"</p>
    </div>
    
    <div class="result info">
        <h3>Step 2: Copy and Paste This SQL</h3>
        <div class="code">
-- Create conversations table
CREATE TABLE IF NOT EXISTS conversations (
    id TEXT PRIMARY KEY,
    user_id TEXT NOT NULL,
    user_message TEXT,
    ai_response TEXT,
    date TIMESTAMP WITH TIME ZONE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create messages table
CREATE TABLE IF NOT EXISTS messages (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    conversation_id TEXT REFERENCES conversations(id) ON DELETE CASCADE,
    role TEXT CHECK (role IN ('user', 'assistant')) NOT NULL,
    content TEXT NOT NULL,
    timestamp TIMESTAMP WITH TIME ZONE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create indexes for better performance
CREATE INDEX IF NOT EXISTS idx_conversations_user_id ON conversations(user_id);
CREATE INDEX IF NOT EXISTS idx_conversations_created_at ON conversations(created_at);
CREATE INDEX IF NOT EXISTS idx_messages_conversation_id ON messages(conversation_id);

-- Enable Row Level Security (RLS)
ALTER TABLE conversations ENABLE ROW LEVEL SECURITY;
ALTER TABLE messages ENABLE ROW LEVEL SECURITY;

-- Create RLS policies (allow all operations for now)
CREATE POLICY "Allow all operations on conversations" ON conversations
    FOR ALL USING (true) WITH CHECK (true);

CREATE POLICY "Allow all operations on messages" ON messages
    FOR ALL USING (true) WITH CHECK (true);
        </div>
    </div>
    
    <div class="result info">
        <h3>Step 3: Run the SQL</h3>
        <p>1. Paste the SQL code above into the SQL Editor</p>
        <p>2. Click "Run" button</p>
        <p>3. You should see "Success" message</p>
    </div>
    
    <div class="result info">
        <h3>Step 4: Test Your Setup</h3>
        <p>After creating the tables, test your connection:</p>
        <p><a href="test-supabase-direct.html" target="_blank">üß™ Test Supabase Connection</a></p>
    </div>
    
    <div class="result info">
        <h3>Step 5: Test Your Voice Journal App</h3>
        <p>Once the tables are created, your Voice Journal app should work:</p>
        <p><a href="journal.html" target="_blank">üìù Voice Journal App</a></p>
    </div>
    
    <script>
        // Auto-copy SQL to clipboard when page loads
        window.onload = function() {
            const sqlCode = `-- Create conversations table
CREATE TABLE IF NOT EXISTS conversations (
    id TEXT PRIMARY KEY,
    user_id TEXT NOT NULL,
    user_message TEXT,
    ai_response TEXT,
    date TIMESTAMP WITH TIME ZONE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create messages table
CREATE TABLE IF NOT EXISTS messages (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    conversation_id TEXT REFERENCES conversations(id) ON DELETE CASCADE,
    role TEXT CHECK (role IN ('user', 'assistant')) NOT NULL,
    content TEXT NOT NULL,
    timestamp TIMESTAMP WITH TIME ZONE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create indexes for better performance
CREATE INDEX IF NOT EXISTS idx_conversations_user_id ON conversations(user_id);
CREATE INDEX IF NOT EXISTS idx_conversations_created_at ON conversations(created_at);
CREATE INDEX IF NOT EXISTS idx_messages_conversation_id ON messages(conversation_id);

-- Enable Row Level Security (RLS)
ALTER TABLE conversations ENABLE ROW LEVEL SECURITY;
ALTER TABLE messages ENABLE ROW LEVEL SECURITY;

-- Create RLS policies (allow all operations for now)
CREATE POLICY "Allow all operations on conversations" ON conversations
    FOR ALL USING (true) WITH CHECK (true);

CREATE POLICY "Allow all operations on messages" ON messages
    FOR ALL USING (true) WITH CHECK (true);`;
            
            // Add copy button
            const copyButton = document.createElement('button');
            copyButton.textContent = 'üìã Copy SQL to Clipboard';
            copyButton.style.cssText = 'padding: 10px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer;';
            copyButton.onclick = function() {
                navigator.clipboard.writeText(sqlCode).then(function() {
                    alert('SQL copied to clipboard!');
                });
            };
            document.body.appendChild(copyButton);
        };
    </script>
</body>
</html>
